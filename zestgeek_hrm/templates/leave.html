{% extends 'base.html' %}
{% load static %}
{% block content %}
{% if messages %}
      <ul class="messages">
          {% for message in messages %}
          {% if message.tags == 'success' %}
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
          <script src="{% static 'assets/js/jquery.toast.js' %}"></script>
            <script>
               var myToast =$.toast({
                  heading: 'Success',
                  text: '{{message}}',
                  showHideTransition: 'slide',
                  icon: 'success',
                  position:'top-right'
               })
            </script>
          {% else %}
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
          <script src="{% static 'assets/js/jquery.toast.js' %}"></script>
            <script>
               var myToast =$.toast({
                  heading: 'Error',
                  text: '{{message}}',
                  showHideTransition: 'slide',
                  icon: 'error',
                  position:'top-right'
               })
            </script>
          {% endif %}
          {% endfor %}
      </ul>
      {% endif %}
   <div class="page-wrapper">
      <div class="content container-fluid">
         <div class="row">
            <div class="col-xl-12 col-sm-12 col-12 mb-4">
               <div class="breadcrumb-path ">
                  <ul class="breadcrumb">
                     <li class="breadcrumb-item"><a href="/home"><img src="{% static 'assets/img/dash.png' %}" class="mr-2" alt="breadcrumb">Home</a></li>
                     <li class="breadcrumb-item active"> Leave</li>
                  </ul>

               </div>
            </div>
         </div>
         <div class="row">
            <div class="col-xl-12 col-sm-12 col-12 ">
               <div class="card">
                  <div class="card-header">
                     <h2 class="card-titles">Apply Leaves</h2>
                  </div>

                  <div class="form-creation">
                      <form method="post" action="">
                          {% csrf_token %}
                     <div class="row">
                        <div class="col-xl-2 col-sm-6 col-12 ">
                           <div class="form-group">
                              <label>Leave Type <span class="mandatory">*</span> </label>
                              <select class="select" name="leave_type" id="leave-type">
                                 <option value="Fullday">Fullday</option>
                                 <option value="Halfday">Halfday</option>
                                 <option value="Shortleave">Shortleave</option>
                              </select>
                           </div>
                        </div>


                        <div class="col-xl-2 col-sm-12 col-12 ">
                           <div class="form-group">
                              <label>From </label>
                              <input type="date" name="start_date" required>
                           </div>
                        </div>
                        <div class="col-xl-2 col-sm-12 col-12 ">
                           <div class="form-group">
                              <label>To</label>
                              <input type="date" name="end_date" required>
                           </div>
                        </div>
                        <div class="col-xl-2 col-sm-6 col-12 " id="time-input">
                           <div class="form-group">
                              <label>Time-From</label>
                              <input type="time" name="start_time" >
                           </div>
                        </div>
                        <div class="col-xl-2 col-sm-6 col-12 " id="time-inputs">
                           <div class="form-group">
                              <label>Time-To</label>
                              <input type="time" name="end_time" >
                           </div>
                        </div>
                        <div class="col-xl-2 col-sm-6 col-12 ">
                           <div class="form-group">
                              <label></label>
                                <button id="add">add</button>

                           </div>
                        </div>

                     </div>
                     <div class="new_class"></div>
                     <div class="row">
                          <div class="col-xl-4 col-sm-6 col-12 ">
                           <div class="form-group">
                              <label>Remaining Leaves</label>
                              <input type="text" value="10" name="remaining_leaves" disabled>
                           </div>
                        </div>
                        <div class="col-xl-4 col-sm-12 col-12 ">
                           <div class="form-group">
                              <label>Comment </label>
                              <input type="text" name="comment">
                           </div>
                        </div>
                        <div class="col-xl-4 col-sm-12 col-12 ">
                           <div class="form-group">
                              <label>Attachments</label>
                              <input type="file" name="attachement">
                           </div>
                        </div>
                     </div>

                     <div class="row">
                        <div class="col-xl-6 col-sm-12 col-12 ">
                           <div class="form-group">
                              <label>Reason </label>
                              <textarea rows="2" cols="50" name="reason">	</textarea>
                           </div>
                        </div>
                        <div class="col-xl-6 col-sm-12 col-12 ">
                           <div class="form-group">
                               <label for="department" class="form-control-label">Department</label>
                        <!--<input class="form-control" name="department" placeholder="Select department">-->
                        <select id="department" name="department" class="form-control">
                           <option value="{{request.user.department.department_name}}">{{request.user.department.department_name}}</option>
                        </select>
                           </div>
                        </div>
                     </div>
                     <div class="row">
                        <div class="col-xl-12 col-sm-12 col-12 ">
                           <div class="form-btn">
                              <button type="submit" value="submit" class="btn btn-primary">Apply</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                           </div>
                        </div>
                     </div>
                                </form>
                  </div>

               </div>
            </div>
         </div>
         <div class="row">
            <div class="col-xl-12 col-sm-12 col-12 ">
               <div class="card">
                  <div class="card-header">
                     <h2 class="card-titles">Leave Details</h2>
                  </div>
                  <div class="card-body p-0">
                     <div class="table-responsive">
                        <table class="table  custom-table  no-footer">
                           <thead>
                              <tr>
                                 <th>Date</th>
                                 <th>Total Employees	</th>
                                 <th>First Half	</th>
                                 <th>Second Half </th>
                                 <th>Working From Home	</th>
                                 <th>Absent</th>
                                 <th>Today Aways</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td><label>05 May 2019 </label></td>
                                 <td><label>7 </label></td>
                                 <td><label>6 </label></td>
                                 <td><label>6 </label></td>
                                 <td><label>1 </label></td>
                                 <td><label>0 </label></td>
                                 <td><label>1 </label></td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div class="row">
            <div class="col-xl-12 col-sm-12 col-12 ">
               <div class="card ">
                  <div class="card-header">
                     <h2 class="card-titles">Leave Details</h2>
                  </div>
                  <div class="card-body p-0">
                     <div class="table-responsive">
                        <table class="table  custom-table  no-footer">
                           <thead>
                              <tr>
                                 <th>Employee</th>
                                 <th>Leave Type </th>
                                 <th>From	</th>
                                 <th>To</th>
                                 <th>Days</th>
                                 <th>Remaining Days	</th>
                                 <th>Notes</th>
                                 <th>Status</th>
                                 <th>Action</th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td>
                                    <div class="table-img">
                                       <a href="profile.html"><img src="{% static 'assets/img/profiles/avatar-13.jpg' %}" alt="profile" class="img-table"></a>
                                       <label>Sean Black</label>
                                    </div>
                                 </td>
                                 <td>
                                    <label>Parental Leave </label>
                                 </td>
                                 <td>
                                    <label>05 Dec 2019 </label>
                                 </td>
                                 <td><label>07 Dec 2019	</label></td>
                                 <td><label>3</label></td>
                                 <td><label>9</label></td>
                                 <td><label>Parenting Leave</label></td>
                                 <td>
                                    <label><a class="action_label3">Approved</a></label>
                                 </td>
                                 <td>
                                    <label><a class="action_label4" data-toggle="modal" data-target="#delete">Delete <i data-feather="trash-2"></i> </a></label>
                                 </td>
                              </tr>
                              <tr>
                                 <td>
                                    <div class="table-img">
                                       <a href="profile.html"><img src="{% static 'assets/img/profiles/avatar-16.jpg' %}" alt="profile" class="img-table"></a>
                                       <label>Linda Craver</label>
                                    </div>
                                 </td>
                                 <td>
                                    <label>Parental Leave </label>
                                 </td>
                                 <td>
                                    <label>05 Dec 2019 </label>
                                 </td>
                                 <td><label>07 Dec 2019	</label></td>
                                 <td><label>3</label></td>
                                 <td><label>9</label></td>
                                 <td><label>Going to Hospital</label></td>
                                 <td>
                                    <label><a class="action_label3">Approved</a></label>
                                 </td>
                                 <td>
                                    <label><a class="action_label4" data-toggle="modal" data-target="#delete">Delete <i data-feather="trash-2"></i> </a></label>
                                 </td>
                              </tr>
                              <tr>
                                 <td>
                                    <div class="table-img">
                                       <a href="profile.html"><img src="{% static 'assets/img/profiles/avatar-17.jpg' %}" alt="profile" class="img-table"></a>
                                       <label>Jenni Sims</label>
                                    </div>
                                 </td>
                                 <td>
                                    <label>Parental Leave </label>
                                 </td>
                                 <td>
                                    <label>05 Dec 2019 </label>
                                 </td>
                                 <td><label>07 Dec 2019	</label></td>
                                 <td><label>3</label></td>
                                 <td><label>9</label></td>
                                 <td><label>Raining</label></td>
                                 <td>
                                    <label><a class="action_label3">Approved</a></label>
                                 </td>
                                 <td>
                                    <label><a class="action_label4" data-toggle="modal" data-target="#delete">Delete <i data-feather="trash-2"></i> </a></label>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="customize_popup">
      <div class="modal fade" id="edit" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
         <div class="modal-dialog modal-lg">
            <div class="modal-content">
               <div class="modal-header">
                  <h5 class="modal-title" id="staticBackdropLabel">Edit Office</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                  </button>
               </div>
               <div class="modal-body">
                  <div class=" col-md-12 p-0">
                     <div class=" form-popup">
                        <label>Office Name</label>
                        <input type="text">
                     </div>
                  </div>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-apply">Apply</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="customize_popup">
      <div class="modal fade" id="editmember" tabindex="-1" aria-labelledby="staticBackdropLabels" aria-hidden="true">
         <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
               <div class="modal-header">
                  <h5 class="modal-title" id="staticBackdropLabels">Edit Member</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">×</span>
                  </button>
               </div>
               <div class="modal-body">
                  <div class=" col-md-12 p-0">
                     <div class=" form-popup">
                        <input type="text" placeholder="Member Name">
                     </div>
                  </div>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-primary">Save</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="customize_popup">
      <div class="modal fade" id="delete" tabindex="-1" aria-labelledby="staticBackdropLabels1" aria-hidden="true">
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
               <div class="modal-header text-centers border-0">
                  <h5 class="modal-title text-center" id="staticBackdropLabels1">Are You Sure Want to Delete?</h5>
               </div>
               <div class="modal-footer text-centers">
                  <button type="button" class="btn btn-primary">Delete</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
<script>
$(document).ready(function() {
  // hide the time input field on page load
  $('#time-input').hide();
  $('#time-inputs').hide();

  // listen for changes to the leave type field using event delegation
$('body').on('change', '#leave-type', function() {
    if ($(this).val() === 'Fullday') {
      // if the leave type is 'Fullday', hide the time input field
      $(this).closest('.row').find('#time-input').hide();
      $(this).closest('.row').find('#time-inputs').hide();
    } else {
      // otherwise, show the time input field
      $(this).closest('.row').find('#time-input').show();
      $(this).closest('.row').find('#time-inputs').show();
    }
  });

  $("#add").click(function(e) {
    console.log('hello');
    var newId = $('.row').length + 1;
    var newRow = '<div class="row">' +
                 '<div class="col-xl-2 col-sm-6 col-12 ">' +
                   '<div class="form-group">' +
                     '<label>Leave Type <span class="mandatory">*</span></label>' +
                     '<select class="select" name="leave_type" id="leave-type">' +
                       '<option value="Select leave">Select leave</option>' +
                       '<option value="Fullday">Fullday</option>' +
                       '<option value="Halfday">Halfday</option>' +
                       '<option value="Shortleave">Shortleave</option>' +
                     '</select>' +
                   '</div>' +
                 '</div>' +
                 '<div class="col-xl-2 col-sm-12 col-12 ">' +
                   '<div class="form-group">' +
                     '<label>From</label>' +
                     '<input type="date" name="start_date" required>' +
                   '</div>' +
                 '</div>' +
                 '<div class="col-xl-2 col-sm-12 col-12 ">' +
                   '<div class="form-group">' +
                     '<label>To</label>' +
                     '<input type="date" name="end_date" required>' +
                   '</div>' +
                 '</div>' +
                 '<div class="col-xl-2 col-sm-6 col-12" id="time-input">' +
                   '<div class="form-group">' +
                     '<label>Time-From</label>' +
                     '<input type="time" name="start_time">' +
                   '</div>' +
                 '</div>' +
                 '<div class="col-xl-2 col-sm-6 col-12" id="time-inputs">' +
                   '<div class="form-group">' +
                     '<label>Time-To</label>' +
                     '<input type="time" name="end_time">' +
                   '</div>' +
                 '</div>' +
                 '<div class="col-xl-2 col-sm-6 col-12 ">' +
                   '<div class="form-group">' +
                     '<label></label>' +
                       '<input type="button" name="deleteRow" value="x" class="deleteRow" style="color:red; font-size:16px;">' +
                     '</div>' +
                   '</div>' +
                 '</div>';
    $(".new_class").append(newRow);
    $('.new_class .row:last-child #time-input').hide();
    $('.new_class .row:last-child #time-inputs').hide();
  });

  // Delete the row when the "x" button is clicked
  $(document).on("click", ".deleteRow", function() {
    $(this).closest(".row").remove();
  });
});

// add event listener to form submit event
$('form').on('submit', function(e) {
    e.preventDefault(); // prevent default form submission behavior
    var form_data = $(this).serialize(); // serialize form data
    alert(form_data)
    // send AJAX request to Django view
    $.ajax({
        type: 'POST',
        url: '/employee_leaves',
        data: form_data,
        success: function(response) {
            // handle successful response
           window.location.reload();
        },
        error: function(response) {
            // handle error response
        }
    });
});

 window.onload=function(){
var today = new Date().toISOString().split('T')[0];
document.getElementsByName("start_date")[0].setAttribute('min', today);
document.getElementsByName("end_date")[0].setAttribute('min', today);
    }

</script>


{% endblock %}